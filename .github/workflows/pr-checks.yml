name: 🔍 Pull Request Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  # ============================================================================
  # PR METADATA
  # ============================================================================
  pr-info:
    name: 📋 PR Information
    runs-on: ubuntu-latest
    
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 📊 PR Stats
        run: |
          echo "## 📊 Pull Request Statistics" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Changes:**" >> $GITHUB_STEP_SUMMARY
          FILES_CHANGED=$(git diff --name-only ${{ github.event.pull_request.base.sha }} ${{ github.sha }} | wc -l)
          echo "- Files changed: $FILES_CHANGED" >> $GITHUB_STEP_SUMMARY
          
          LINES_ADDED=$(git diff --numstat ${{ github.event.pull_request.base.sha }} ${{ github.sha }} | awk '{sum+=$1} END {print sum}')
          LINES_REMOVED=$(git diff --numstat ${{ github.event.pull_request.base.sha }} ${{ github.sha }} | awk '{sum+=$2} END {print sum}')
          echo "- Lines added: $LINES_ADDED" >> $GITHUB_STEP_SUMMARY
          echo "- Lines removed: $LINES_REMOVED" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

      - name: 🏷️ Check labels
        run: |
          echo "Checking PR labels..."
          # You can add logic here to ensure PRs have appropriate labels
          echo "✅ Label check complete"

  # ============================================================================
  # CODE REVIEW CHECKLIST
  # ============================================================================
  review-checklist:
    name: ✅ Review Checklist
    runs-on: ubuntu-latest
    
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@v4

      - name: 📝 Generate review checklist
        run: |
          echo "## ✅ Code Review Checklist" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Please verify:" >> $GITHUB_STEP_SUMMARY
          echo "- [ ] Code follows project style guidelines" >> $GITHUB_STEP_SUMMARY
          echo "- [ ] Tests are included for new features" >> $GITHUB_STEP_SUMMARY
          echo "- [ ] Documentation is updated" >> $GITHUB_STEP_SUMMARY
          echo "- [ ] No sensitive data (API keys, passwords) committed" >> $GITHUB_STEP_SUMMARY
          echo "- [ ] All tests pass" >> $GITHUB_STEP_SUMMARY
          echo "- [ ] No merge conflicts" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

  # ============================================================================
  # DEPENDENCY CHANGES
  # ============================================================================
  dependency-check:
    name: 📦 Dependency Check
    runs-on: ubuntu-latest
    
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 🔍 Check dependency changes
        run: |
          echo "Checking for dependency changes..."
          
          if git diff --name-only ${{ github.event.pull_request.base.sha }} ${{ github.sha }} | grep -E "package.json|requirements.txt"; then
            echo "⚠️ Dependencies changed in this PR!" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "Please ensure:" >> $GITHUB_STEP_SUMMARY
            echo "- Dependencies are necessary" >> $GITHUB_STEP_SUMMARY
            echo "- Versions are pinned appropriately" >> $GITHUB_STEP_SUMMARY
            echo "- Security audit has been run" >> $GITHUB_STEP_SUMMARY
          else
            echo "✅ No dependency changes"
          fi

  # ============================================================================
  # SIZE CHECK
  # ============================================================================
  size-check:
    name: 📏 PR Size Check
    runs-on: ubuntu-latest
    
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 📏 Check PR size
        run: |
          FILES_CHANGED=$(git diff --name-only ${{ github.event.pull_request.base.sha }} ${{ github.sha }} | wc -l)
          LINES_CHANGED=$(git diff --shortstat ${{ github.event.pull_request.base.sha }} ${{ github.sha }} | awk '{print $4+$6}')
          
          echo "Files changed: $FILES_CHANGED"
          echo "Lines changed: $LINES_CHANGED"
          
          if [ "$FILES_CHANGED" -gt 50 ] || [ "$LINES_CHANGED" -gt 1000 ]; then
            echo "⚠️ **Large PR Warning**" >> $GITHUB_STEP_SUMMARY
            echo "This PR is quite large. Consider:" >> $GITHUB_STEP_SUMMARY
            echo "- Breaking into smaller PRs" >> $GITHUB_STEP_SUMMARY
            echo "- Adding detailed description" >> $GITHUB_STEP_SUMMARY
            echo "- Including comprehensive tests" >> $GITHUB_STEP_SUMMARY
          else
            echo "✅ PR size is reasonable"
          fi

  # ============================================================================
  # FINAL STATUS
  # ============================================================================
  pr-ready:
    name: ✅ PR Ready for Review
    runs-on: ubuntu-latest
    needs: [pr-info, review-checklist, dependency-check, size-check]
    
    steps:
      - name: 🎉 PR Status
        run: |
          echo "════════════════════════════════════════"
          echo "  ✨ PR is ready for review! ✨"
          echo "  All automated checks passed"
          echo "════════════════════════════════════════"



